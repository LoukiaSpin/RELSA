RELSA2       <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore2  <- as.numeric(unlist(RELSA2$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
# show raw data + RELSA
f_name  <- paste("RELSA TM vs Sham carp",".tiff",sep="")
mypath  <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/", f_name,sep="")
tiff(file = mypath, width = 1500, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plotset       <- relsa_plot(pre_test, RELSA, levels=levels, animal=animal, plotvar=NULL,
plotRELSA=TRUE, myylim=c(80,120), myYlim=c(0,1.4), mypch=19, myXlab="day")
lines(c(-1:28), relsascore2, type="b", pch=17 )
text(26,levels$level1+0.06, levels$level1 )
text(26,levels$level2+0.06, levels$level2 )
text(26,levels$level3+0.06, levels$level3 )
text(26,levels$level4+0.06, levels$level4 )
legend("topright", c("TM/Carprofen","Sham/Carprofen"), pch=c(19,17), lty=c(1,1), col=c("red","black"), bty="n")
dev.off()
##### Laura Model Single Tests #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laura.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("bur2h","burON","hr","hrv", "temp", "act", "mgs" ), ontime=1)
animal       <- 12
RELSA        <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
animal       <- 15
RELSA2       <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore2  <- as.numeric(unlist(RELSA2$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
# show raw data + RELSA
f_name  <- paste("RELSA TM vs Sham carp",".tiff",sep="")
mypath  <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/", f_name,sep="")
tiff(file = mypath, width = 1500, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plotset       <- relsa_plot(pre_test, RELSA, levels=levels, animal=animal, plotvar=NULL,
plotRELSA=TRUE, myylim=c(80,120), myYlim=c(0,1.4), mypch=19, myXlab="day")
lines(c(-1:28), relsascore2, type="b", pch=17 )
text(26,levels$level1+0.06, levels$level1 )
text(26,levels$level2+0.06, levels$level2 )
text(26,levels$level3+0.06, levels$level3 )
text(26,levels$level4+0.06, levels$level4 )
legend("topright", c("TM/Carprofen","Sham/Carprofen"), pch=c(19,17), lty=c(1,1), col=c("red","black"), bty="n")
dev.off()
animal       <- 12
RELSA        <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
RELSA
testset[testset$id==unique(testset$id)[animal],]
##### Laura Model Single Tests #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laura.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("bur2h","burON","hr","hrv", "temp", "act", "mgs" ), ontime=1)
animal       <- 3
RELSA        <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
animal       <- 15
RELSA2       <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore2  <- as.numeric(unlist(RELSA2$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
##### Laura Model Single Tests #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laura.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("bur2h","burON","hr","hrv", "temp", "act", "mgs" ), ontime=1)
animal       <- 4
RELSA        <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
RELSA
##### Laura Model Single Tests #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laura.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("bur2h","burON","hr","hrv", "temp", "act", "mgs" ), ontime=1)
animal       <- 4
RELSA        <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
animal       <- 15
RELSA2       <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore2  <- as.numeric(unlist(RELSA2$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
# show raw data + RELSA
f_name  <- paste("RELSA TM vs Sham carp",".tiff",sep="")
mypath  <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/", f_name,sep="")
tiff(file = mypath, width = 1500, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plotset       <- relsa_plot(pre_test, RELSA, levels=levels, animal=animal, plotvar=NULL,
plotRELSA=TRUE, myylim=c(80,120), myYlim=c(0,1.4), mypch=19, myXlab="day")
lines(c(-1:28), relsascore2, type="b", pch=17 )
text(26,levels$level1+0.06, levels$level1 )
text(26,levels$level2+0.06, levels$level2 )
text(26,levels$level3+0.06, levels$level3 )
text(26,levels$level4+0.06, levels$level4 )
legend("topright", c("TM/Carprofen","Sham/Carprofen"), pch=c(19,17), lty=c(1,1), col=c("red","black"), bty="n")
dev.off()
animal       <- 4
RELSA        <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
#########################################################################################################################
########## Wheel running approach
#########################################################################################################################
raw          <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laufrad.txt" )
vars         <- c("bwc","hr", "hrv", "act", "rotdark" ) #, "rot20", "vmax"
turnvars     <- c("hr" )
org          <- cbind(raw[,1:4], raw[,vars])
pre          <- relsa_norm(org,  normthese=c("hr", "hrv", "act", "rotdark" ), ontime=1)
bsl          <- relsa_baselines(dataset=pre, bslday=-1, variables=vars, turnvars=turnvars)
levels       <- relsa_levels(pre, mypath="C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Clusters/", bsl,
filename="RW levels", drops=NULL, turns="hr", relsaNA=NA, k=4,
showScree="no", customCol= c("green","magenta","blue","red"), seed=123, myYlim=c(0,1.4),
saveTiff="yes")
##### Laura Laufrad Single Tests #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laufrad.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("hr", "hrv", "act", "rotdark" ), ontime=1)
animal        <- 13# 8
RELSA         <- relsa(testset, bsl, a=animal, drop=c("bw","score","vmax","rr","rot20"),
turnvars=NULL, relsaNA=NA)
testset[testset$id==unique(testset$id)[animal],]
RELSA
library(RELSA)
raw          <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laura.txt", treatment = "Transmitter" )
vars         <- c("bwc", "bur2h","burON","hr","hrv", "temp", "act", "mgs")
turnvars     <- c("hr", "mgs", "temp" )
org          <- cbind(raw[,1:4], raw[,vars])
pre          <- relsa_norm(org,   normthese=c("bur2h","burON","hr","hrv", "temp", "act", "mgs" ), ontime=1)
bsl          <- relsa_baselines(dataset=pre, bslday=-1, variables=vars, turnvars=turnvars)
levels       <- relsa_levels(pre, mypath="C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Clusters/", bsl,
filename="Burrowing levels", drops=c("bw","score"), turns=c("hr","mgs","temp"), relsaNA=NA, k=4,
showScree="no", customCol= c("red","green","blue","magenta"), seed=123, myYlim=c(0,1.4),
saveTiff="yes")
##### Laura Model Single Tests #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laura.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("bur2h","burON","hr","hrv", "temp", "act", "mgs" ), ontime=1)
animal       <- 4
RELSA        <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
animal       <- 15
RELSA2       <- relsa(set=testset, bsl, a=animal, drop=c("bw","score","mgs30","mgs180" ), turnvars=c("hr", "mgs","temp" ), relsaNA=NA)
relsascore2  <- as.numeric(unlist(RELSA2$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
# show raw data + RELSA
f_name  <- paste("RELSA TM vs Sham carp",".tiff",sep="")
mypath  <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/", f_name,sep="")
tiff(file = mypath, width = 1500, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plotset       <- relsa_plot(pre_test, RELSA, levels=levels, animal=animal, plotvar=NULL,
plotRELSA=TRUE, myylim=c(80,120), myYlim=c(0,1.4), mypch=19, myXlab="day")
lines(c(-1:28), relsascore2, type="b", pch=17 )
text(26,levels$level1+0.06, levels$level1 )
text(26,levels$level2+0.06, levels$level2 )
text(26,levels$level3+0.06, levels$level3 )
text(26,levels$level4+0.06, levels$level4 )
legend("topright", c("TM/Carprofen","Sham/Carprofen"), pch=c(19,17), lty=c(1,1), col=c("red","black"), bty="n")
dev.off()
##### Marcin Model Single Tests #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/marcin_clp.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("bwc","temp"), ontime=2)
animal       <- 19 #19 is good paper showcase
RELSA        <- relsa(testset, bsl, a=animal, drop=NULL, turnvars="temp")
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
# show raw data + RELSA
f_name  <- paste("Marcin CLP",".tiff",sep="")
mypath  <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/", f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plotset      <- relsa_plot(testset, levels=levels, RELSA, animal=animal, plotvar=NULL,
plotRELSA=TRUE, myylim=c(70,120), myYlim=c(0,4), mypch=15, mycol="black", myXlab="day")
legend("topleft", c("CLP (bwc/temp)"), pch=c(15), lty=c(1 ), col=c("black"), bty="n")
dev.off()
RELSA
#########################################################################################################################
########## Wheel running approach
#########################################################################################################################
raw          <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laufrad.txt" )
vars         <- c("bwc","hr", "hrv", "act", "rotdark" ) #, "rot20", "vmax"
turnvars     <- c("hr" )
org          <- cbind(raw[,1:4], raw[,vars])
pre          <- relsa_norm(org,  normthese=c("hr", "hrv", "act", "rotdark" ), ontime=1)
bsl          <- relsa_baselines(dataset=pre, bslday=-1, variables=vars, turnvars=turnvars)
levels       <- relsa_levels(pre, mypath="C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Clusters/", bsl,
filename="RW levels", drops=NULL, turns="hr", relsaNA=NA, k=4,
showScree="no", customCol= c("green","magenta","blue","red"), seed=123, myYlim=c(0,1.4),
saveTiff="yes")
##### Laura Laufrad Single Tests #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/post-op laufrad.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("hr", "hrv", "act", "rotdark" ), ontime=1)
animal        <- 13# 8
RELSA         <- relsa(testset, bsl, a=animal, drop=c("bw","score","vmax","rr","rot20"),
turnvars=NULL, relsaNA=NA)
testset[testset$id==unique(testset$id)[animal],]
animal        <- 21
RELSA2        <- relsa(testset, bsl, a=animal, drop=c("bw","score","vmax","rr","rot20"),
turnvars=NULL, relsaNA=NA)
relsascore2   <- as.numeric(unlist(RELSA2$relsa$rms))
testset[testset$id==unique(testset$id)[animal],]
# show raw data + RELSA
f_name  <- paste("RELSA WR TM vs Sham meta",".tiff",sep="")
mypath  <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/", f_name,sep="")
tiff(file = mypath, width = 1500, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plotset       <- relsa_plot(pre_test, RELSA, levels=levels, animal=animal, plotvar=NULL,
plotRELSA=TRUE, myylim=c(80,120), myYlim=c(0,1.4), mypch=19, myXlab="day")
lines(c(-1:28), relsascore2, type="b", pch=17 )
text(26,levels$level1+0.06, levels$level1 )
text(26,levels$level2+0.06, levels$level2 )
text(26,levels$level3+0.06, levels$level3 )
text(26,levels$level4+0.06, levels$level4 )
legend("topright", c("RW TM/Metamizol","RW Sham/Metamizol"), pch=c(19,17), lty=c(1,1), col=c("red","black"), bty="n")
dev.off()
##### Svenja DSS #########################################
testraw      <- relsa_load("C:/MHH Bleich/Papers/PostOPPaper/Data/svenja_dss_mod.txt" )
vars         <- names(testraw[,-c(1:4)])
pre_test     <- cbind(testraw[,1:4], testraw[,vars])
testset      <- relsa_norm(pre_test, normthese=c("bwc", "rotdark", "vmax"), ontime=1)
animal       <- 98
RELSA        <- relsa(set=testset, bsl, a=animal, drop="vmax", turnvars=NULL, relsaNA=NA)
relsascore   <- as.numeric(unlist(RELSA$relsa$rms))
tier         <- testset[testset$id==unique(testset$id)[animal],]
# show raw data + RELSA
f_name  <- paste("Svenja Tier 98",".tiff",sep="")
mypath  <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/", f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plotset      <- relsa_plot(testset, levels=levels, RELSA, animal=animal, plotvar=NULL,
plotRELSA=TRUE, myylim=c(70,120), myYlim=c(0,4), mypch=15, mycol="black", myXlab="day")
legend("topleft", c("1% DSS + BS (bwc/vwr)"), pch=c(15), lty=c(1 ), col=c("black"), bty="n")
dev.off()
RELSA
library(Boruta)
?Boruta
library(RELSA)
# Build model -------------------------------------------------------------
raw          <- postop
vars         <- c("bwc", "bur2h", "burON", "hr", "hrv", "temp", "act", "mgs")
turnvars     <- c("hr", "mgs", "temp" )
pre          <- relsa_norm(cbind(raw[,1:4], raw[,vars]),
normthese = c("bur2h", "burON", "hr", "hrv", "temp", "act", "mgs"), ontime = 1)
bsl          <- relsa_baselines(dataset = pre, bslday = -1, variables = vars, turnvars = turnvars)
levels       <- relsa_levels(pre, bsl = bsl, drops = c("bw", "score"), turns = c("hr", "mgs", "temp"),
k = 4, customCol = c("red", "green", "blue", "magenta"))
# Test model --------------------------------------------------------------
animal       <- 1
RELSA        <- relsa(set = pre, bsl, a = animal,
drop=c("bw", "score", "mgs30", "mgs180"), turnvars = turnvars)
head(RELSA$relsa$rms)
cbind(raw[,1:4], raw[,vars]
)
raw
animal       <- 1
RELSA        <- relsa(set = pre, bsl, a = animal,
drop=c("bw", "score", "mgs30", "mgs180"), turnvars = turnvars)
head(RELSA$relsa$rms)
dim(cbind(raw[,1:4], raw[,vars]))
dim(raw)
names(cbind(raw[,1:4], raw[,vars]))
names(raw)
# Build model -------------------------------------------------------------
raw          <- postop
vars         <- c("bwc", "bur2h", "burON", "hr", "hrv", "temp", "act", "mgs")
turnvars     <- c("hr", "mgs", "temp" )
pre          <- relsa_norm(raw),
normthese = c("bur2h", "burON", "hr", "hrv", "temp", "act", "mgs"), ontime = 1)
bsl          <- relsa_baselines(dataset = pre, bslday = -1, variables = vars, turnvars = turnvars)
levels       <- relsa_levels(pre, bsl = bsl, drops = c("bw", "mgs30", "mgs180", "score"), turns = c("hr", "mgs", "temp"),
k = 4, customCol = c("red", "green", "blue", "magenta"))
# Test model --------------------------------------------------------------
animal       <- 1
RELSA        <- relsa(set = pre, bsl, a = animal,
drop=c("bw", "score", "mgs30", "mgs180"), turnvars = turnvars)
head(RELSA$relsa$rms)
library(RELSA)
# Build model -------------------------------------------------------------
raw          <- postop
vars         <- c("bwc", "bur2h", "burON", "hr", "hrv", "temp", "act", "mgs")
turnvars     <- c("hr", "mgs", "temp" )
pre          <- relsa_norm(raw,
normthese = c("bur2h", "burON", "hr", "hrv", "temp", "act", "mgs"), ontime = 1)
bsl          <- relsa_baselines(dataset = pre, bslday = -1, variables = vars, turnvars = turnvars)
levels       <- relsa_levels(pre, bsl = bsl, drops = c("bw", "mgs30", "mgs180", "score"), turns = c("hr", "mgs", "temp"),
k = 4, customCol = c("red", "green", "blue", "magenta"))
pre
animal       <- 1
RELSA        <- relsa(set = pre, bsl, a = animal,
drop=c("bw", "score", "mgs30", "mgs180"), turnvars = turnvars)
RELSA
library(RELSA)
pch
library(RELSA)
library(reshape2)
library("factoextra")
library("FactoMineR")
library(Boruta)
library("dichromat")
##############################################
### Load data
setwd("C:/MHH Bleich/Papers/PostOPPaper/")
filename     <- "./Data/post-op laura.txt"
figpath      <- paste(getwd(),"/Figs/", sep="")
laura        <- read.table(filename, header = T, row.names = 1)
laura        <- laura[laura$treatment=="Transmitter", ]
daylist      <- c(0,1,2,4,7)
drop         <- c("bw","score","mgs30","mgs180")
### scale variables - singular values!
dataset      <- laura[,-which(names(laura) %in% drop)]
for( i in 1:length(daylist)){
POSTOP     <- dataset[dataset$day %in% c(-1, daylist[i]),  c(4, 5:12)]
# kick out partially empty columns
lossID         <- which(colSums(apply(POSTOP,2, FUN=is.na)) >0)
if(length(lossID)==0){
POSTOP  <- POSTOP
}else{
POSTOP  <- POSTOP[,-lossID]
}
# Boruta (eliminate missing columns where there are no comparisons!)
borutainput    <- POSTOP
set.seed(321)
out.boruta     <- Boruta(borutainput$day~., data = borutainput, doTrace=0)
f_name         <- paste("Boruta BSL vs day ", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Boruta Plots/", f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 11, res = 300, compression = "lzw")
print( plot(out.boruta, cex.axis = 0.7, cex.lab=1.2, cex=1, las=2, xlab="", ylim=c(-10,18)) )
abline(h=0, lty=2)
dev.off()
}
install.packages("factoextra")
install.packages("FactoMineR")
library(reshape2)
library("factoextra")
library("FactoMineR")
library(Boruta)
library("dichromat")
##############################################
### Load data
setwd("C:/MHH Bleich/Papers/PostOPPaper/")
filename     <- "./Data/post-op laura.txt"
figpath      <- paste(getwd(),"/Figs/", sep="")
laura        <- read.table(filename, header = T, row.names = 1)
laura        <- laura[laura$treatment=="Transmitter", ]
daylist      <- c(0,1,2,4,7)
drop         <- c("bw","score","mgs30","mgs180")
### scale variables - singular values!
dataset      <- laura[,-which(names(laura) %in% drop)]
for( i in 1:length(daylist)){
POSTOP     <- dataset[dataset$day %in% c(-1, daylist[i]),  c(4, 5:12)]
# kick out partially empty columns
lossID         <- which(colSums(apply(POSTOP,2, FUN=is.na)) >0)
if(length(lossID)==0){
POSTOP  <- POSTOP
}else{
POSTOP  <- POSTOP[,-lossID]
}
# Boruta (eliminate missing columns where there are no comparisons!)
borutainput    <- POSTOP
set.seed(321)
out.boruta     <- Boruta(borutainput$day~., data = borutainput, doTrace=0)
f_name         <- paste("Boruta BSL vs day ", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Boruta Plots/", f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 11, res = 300, compression = "lzw")
print( plot(out.boruta, cex.axis = 0.7, cex.lab=1.2, cex=1, las=2, xlab="", ylim=c(-10,18)) )
abline(h=0, lty=2)
dev.off()
}
########### PCA ###########
set        <- dataset[dataset$day %in% c(-1, daylist),  c(4, 5:12)]
set        <- set[complete.cases(set), ]
# PCA
tm.pca     <- prcomp(set[,-1], scale = TRUE, center=TRUE)
sepath     <- "C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/PCA Burrowing/"
# Variable contribution
f_name  <- paste("PCA_C",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 7,res = 300, compression = "lzw")
fviz_pca_var(tm.pca, col.var="contrib",
gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
repel = TRUE) + theme(text = element_text(size = 8.5),
axis.title = element_text(size = 13.5),
axis.text = element_text(size = 13.5))
dev.off()
f_name  <- paste("PCA_A",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 7,res = 300, compression = "lzw")
fviz_contrib(tm.pca, choice = "var", axes = 1, top = 28, xtickslab.rt = 90, ylim=c(0,60) )
dev.off()
f_name  <- paste("PCA_B",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 5,res = 300, compression = "lzw")
fviz_contrib(tm.pca, choice = "var", axes = 2, top = 28, xtickslab.rt = 90, ylim=c(0,60) )
dev.off()
# Full PCA plot
f_name  <- paste("PCA_D",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 1,res = 300, compression = "lzw")
mypalette <- c("darkgreen","red3","red","orange","red4")
set$day[set$day==-1] <- "bsl"
set$day[set$day== 0] <- "post-op"
set$day[set$day== 1] <- "day 1"
set$day[set$day== 2] <- "day 2"
set$day[set$day== 4] <- "day 4"
days      <- as.factor(set$day)
fviz_pca_ind(tm.pca,
col.ind       = factor(set$day),
title         = " ",
addEllipses   = T,
ellipse.type  = "confidence",
legend.title  = "Days",
geom.ind      = "point",
repel         = F,
ellipse.level = 0.95,
palette       = mypalette,#(5), # viridis_pal(option = "D")(9)
pointsize = 2)
dev.off()
daylist
########### PCA ###########
set        <- dataset[dataset$day %in% c(-1, daylist),  c(4, 5:12)]
set        <- set[complete.cases(set), ]
# PCA
tm.pca     <- prcomp(set[,-1], scale = TRUE, center=TRUE)
sepath     <- "C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/PCA Burrowing/"
# Variable contribution
f_name  <- paste("PCA_C",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 7,res = 300, compression = "lzw")
fviz_pca_var(tm.pca, col.var="contrib",
gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
repel = TRUE) + theme(text = element_text(size = 8.5),
axis.title = element_text(size = 13.5),
axis.text = element_text(size = 13.5))
dev.off()
tm.pca
fviz_contrib(tm.pca, choice = "var", axes = 1, top = 28, xtickslab.rt = 90, ylim=c(0,60) )
a<-fviz_contrib(tm.pca, choice = "var", axes = 1, top = 28, xtickslab.rt = 90, ylim=c(0,60) )
a
print(a)
fviz_contrib(tm.pca, choice = "var", axes = 1, top = 28, xtickslab.rt = 90, ylim=c(0,60), verbose=T )
?fviz_contrib
print.factoextra(fviz_contrib(tm.pca, choice = "var", axes = 1, top = 28, xtickslab.rt = 90, ylim=c(0,60), verbose=T ))
f_name  <- paste("PCA_A",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 7,res = 300, compression = "lzw")
p <- fviz_contrib(tm.pca, choice = "var", axes = 1, top = 28, xtickslab.rt = 90, ylim=c(0,60))
dev.off()
print(p)
p
tm.pca
contrib  <- round(res.pca$var$contrib,3) [,1:3]
contrib  <- round(tm.pca$var$contrib,3) [,1:3]
tm.pca
tm.pca$var
set        <- dataset[dataset$day %in% c(-1, daylist),  c(4, 5:12)]
set        <- set[complete.cases(set), ]
# PCA
tm.pca     <- prcomp(set[,-1], scale = TRUE, center=TRUE)
var        <- get_pca_var(res.pca)
var
get_pca_var(res.pca)
var        <- get_pca_var(tm.pca)
var
head(var$contrib, 4)
head(var$contrib )
var        <- get_pca_var(tm.pca)
var$contrib
100/8
##############################################
### Load data LAUFRAD
setwd("C:/MHH Bleich/Papers/PostOPPaper/")
filename     <- "./Data/post-op laufrad.txt"
figpath      <- paste(getwd(),"/for paper laufrad/", sep="")
laufrad      <- read.table(filename, header = T, row.names = 1)
daylist      <- c(0,1,2,4,7)
drop         <- c("bw", "score", "rr","rot20","vmax")
### scale variables - singular values!
dataset      <- laufrad[,-which(names(laufrad) %in% drop)]
for( i in 1:length(daylist)){
POSTOP     <- dataset[dataset$day %in% c(-1, daylist[i]),  c(4, 5:9)]
POSTOP     <- POSTOP[complete.cases(POSTOP),]
# kick out partially empty columns
lossID         <- which(colSums(apply(POSTOP,2, FUN=is.na)) >0)
if(length(lossID)==0){
POSTOP  <- POSTOP
}else{
POSTOP  <- POSTOP[,-lossID]
}
# Boruta (eliminate missing columns where there are no comparisons!)
borutainput    <- POSTOP
set.seed(321)
out.boruta     <- Boruta(borutainput$day~., data = borutainput, doTrace=0)
f_name         <- paste("Boruta RW BSL vs day ", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Boruta Plots/Boruta RW/", f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 11, res = 300, compression = "lzw")
print( plot(out.boruta, cex.axis = 0.7, cex.lab=1.2, cex=1, las=2, xlab="", ylim=c(-10,25)) )
abline(h=0, lty=2)
dev.off()
}
########### PCA ###########
set        <- dataset[dataset$day %in% c(-1, daylist),  c(4, 5:9)]
set        <- set[complete.cases(set), ]
# PCA
tm.pca     <- prcomp(set[,-1], scale = TRUE, center=TRUE)
# contributions
var        <- get_pca_var(tm.pca)
var$contrib
100/5
dataset[dataset$day %in% c(-1, daylist),  c(4, 5:9)]
library(RELSA)
