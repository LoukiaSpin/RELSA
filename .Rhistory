abline(h=levels$level3, lwd=1, lty=2)
abline(h=levels$level4, lwd=1, lty=2)
legend("topright", c( "mean RELSA score", "RELSA levels","10 % threshold"),
pch=c(19,NA,NA), lty=c(NA,2,1), col=c("black","black","red"), bty="n", cex=0.8)
dev.off()
# best combination SETS
best          <- data.frame(permuts= permuts             [meanscores[zeitpunkt,]   >thr,],
relsa  = meanscores[zeitpunkt,][meanscores[zeitpunkt,] >thr ])
colnames(best)<- c(vars,"relsa")
best          <- best[1:dim(best)[1], ]
best          <- best[order(best$relsa, decreasing=TRUE),]
best
V <- c()
for(v in 1:dim(best)[1]){
varnames <- best[v,1:8]
varnames <- varnames[!is.na(varnames)]
V[v]     <- paste( as.character(varnames), collapse=",", sep="")
}
a <- barplot(best$relsa, names.arg="", las=3, srt = 45, ylab="Mean RELSA score", ylim=c(0,1), horiz = FALSE)
text(a[,1], -0.05, srt = 45, adj= 1, xpd = TRUE, labels = V , cex=0.8)
library(reshape2)
library("factoextra")
library("FactoMineR")
library(Boruta)
library("dichromat")
##############################################
### Load data
setwd("C:/MHH Bleich/Papers/PostOPPaper/")
filename     <- "./Data/post-op laura.txt"
figpath      <- paste(getwd(),"/Figs/", sep="")
laura        <- read.table(filename, header = T, row.names = 1)
laura        <- laura[laura$treatment=="Transmitter", ]
daylist      <- c(0,1,2,4,7)
drop         <- c("bw","score","mgs30","mgs180")
### scale variables - singular values!
dataset      <- laura[,-which(names(laura) %in% drop)]
for( i in 1:length(daylist)){
POSTOP     <- dataset[dataset$day %in% c(-1, daylist[i]),  c(4, 5:12)]
# kick out partially empty columns
lossID         <- which(colSums(apply(POSTOP,2, FUN=is.na)) >0)
if(length(lossID)==0){
POSTOP  <- POSTOP
}else{
POSTOP  <- POSTOP[,-lossID]
}
# Boruta (eliminate missing columns where there are no comparisons!)
borutainput    <- POSTOP
set.seed(321)
out.boruta     <- Boruta(borutainput$day~., data = borutainput, doTrace=0)
f_name         <- paste("Boruta BSL vs day ", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Boruta Plots/", f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 11, res = 300, compression = "lzw")
print( plot(out.boruta, cex.axis = 0.7, cex.lab=1.2, cex=1, las=2, xlab="", ylim=c(-10,18)) )
abline(h=0, lty=2)
dev.off()
}
########### PCA ###########
# http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/112-pca-principal-component-analysis-essentials/
set        <- dataset[dataset$day %in% c(-1, daylist),  c(4, 5:12)]
set        <- set[complete.cases(set), ]
# PCA
tm.pca     <- prcomp(set[,-1], scale = TRUE, center=TRUE)
# contributions
var        <- get_pca_var(tm.pca)
var$contrib
sepath     <- "C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/PCA Burrowing/"
# Variable contribution
f_name  <- paste("PCA_C",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 7,res = 300, compression = "lzw")
fviz_pca_var(tm.pca, col.var="contrib",
gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
repel = TRUE) + theme(text = element_text(size = 8.5),
axis.title = element_text(size = 13.5),
axis.text = element_text(size = 13.5))
dev.off()
f_name  <- paste("PCA_A",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 7,res = 300, compression = "lzw")
fviz_contrib(tm.pca, choice = "var", axes = 1, top = 28, xtickslab.rt = 90, ylim=c(0,60))
dev.off()
f_name  <- paste("PCA_B",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 5,res = 300, compression = "lzw")
fviz_contrib(tm.pca, choice = "var", axes = 2, top = 28, xtickslab.rt = 90, ylim=c(0,60) )
dev.off()
# Full PCA plot
f_name  <- paste("PCA_D",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 1,res = 300, compression = "lzw")
mypalette <- c("darkgreen","red3","red","orange","red4")
set$day[set$day==-1] <- "bsl"
set$day[set$day== 0] <- "post-op"
set$day[set$day== 1] <- "day 1"
set$day[set$day== 2] <- "day 2"
set$day[set$day== 4] <- "day 4"
days      <- as.factor(set$day)
fviz_pca_ind(tm.pca,
col.ind       = factor(set$day),
title         = " ",
addEllipses   = T,
ellipse.type  = "confidence",
legend.title  = "Days",
geom.ind      = "point",
repel         = F,
ellipse.level = 0.95,
palette       = mypalette,#(5), # viridis_pal(option = "D")(9)
pointsize = 2)
dev.off()
turned
set        <- dataset[dataset$day %in% c(-1, daylist),  c(4, 5:12)]
set        <- set[complete.cases(set), ]
set
daylist
POSTOP     <- set[set$day %in% c(-1, daylist[i]), c(4, 5:15)]
POSTOP     <- set[set$day %in% c(-1, daylist[2]), c(4, 5:15)]
laura[laura$day %in% c(-1, daylist),  c(4, 5:12)]
laura[laura$day %in% c(-1, daylist),  c(1,4, 5:12)]
set        <- laura[laura$day %in% c(-1, daylist),  c(1,4, 5:12)]
set        <- set[complete.cases(set), ]
POSTOP     <- set[set$day %in% c(-1, daylist[2]), c(4, 5:15)]
POSTOP     <- set[set$day %in% c(-1, daylist[2]) ]
POSTOP
daylist[2]
POSTOP     <- set[set$day %in% c(-1, daylist[2]), ]
POSTOP
set$day %in% c(-1, daylist[2])
daylist    <- c(0,1,2,4,7)
set        <- laura[laura$day %in% c(-1, daylist),  c(1,4, 5:12)]
set        <- set[complete.cases(set), ]
set
daylist    <- c(0,1,2,4,7)
set        <- laura[laura$day %in% c(-1, daylist),  c(1,4, 5:12)]
set
POSTOP     <- set[ set$day %in% c(-1, daylist[2]), ]
POSTOP
POSTOP     <- set[ set$day %in% c(-1, daylist[2]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP
set        <- laura[laura$day %in% c(-1, daylist),  c(1,4, 5:12)]
set
##############################################
### Load data
setwd("C:/MHH Bleich/Papers/PostOPPaper/")
filename     <- "./Data/post-op laura.txt"
figpath      <- paste(getwd(),"/Figs/", sep="")
laura        <- read.table(filename, header = T, row.names = 1)
laura        <- laura[laura$treatment=="Transmitter", ]
daylist      <- c(0,1,2,4,7)
laura
set        <- laura[laura$day %in% c(-1, daylist),  c(1,4, 5:12)]
set
laura
set             <- laura
POSTOP          <- set[ set$day %in% c(-1, daylist[2]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
library(varrank)
install.packages("varrank")
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
library(varrank)
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
v
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
# Entropy -----------------------------------------------------------------
set             <- laura
POSTOP          <- set[ set$day %in% c(-1, daylist[2]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP
POSTOP[,4:dim(POSTOP)[2]]
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
v
v
round(diag(v$distance.m),2)
set[ set$day %in% c(-1, daylist[2]), ]
POSTOP          <- set[ set$day %in% c(-1, daylist[1]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
daylist[1]
daylist[2]
POSTOP          <- set[ set$day %in% c(-1, daylist[2]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
POSTOP          <- set[ set$day %in% c(-1, daylist[3]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
f_name         <- paste("Entropy BSL vs day", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Entropy/",f_name,sep="")
tiff(file = mypath, width = 1800, height = 1500, units = "px", pointsize = 10,res = 400, compression = "lzw")
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
dev.off()
# Entropy Burrowing -------------------------------------------------------
set             <- laura
for(i in 1:length(daylist)){
POSTOP          <- set[ set$day %in% c(-1, daylist[i]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
f_name         <- paste("Entropy BSL vs day", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Entropy/",f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 10,res = 400, compression = "lzw")
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
dev.off()
}
# Entropy Burrowing -------------------------------------------------------
set             <- laura
for(i in 1:length(daylist)){
POSTOP          <- set[ set$day %in% c(-1, daylist[i]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
f_name         <- paste("Entropy BSL vs day", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Entropy/",f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
dev.off()
}
##############################################
### Load data LAUFRAD
setwd("C:/MHH Bleich/Papers/PostOPPaper/")
filename     <- "./Data/post-op laufrad.txt"
figpath      <- paste(getwd(),"/for paper laufrad/", sep="")
laufrad      <- read.table(filename, header = T, row.names = 1)
daylist      <- c(0,1,2,4,7)
drop         <- c("bw", "score", "rr","rot20","vmax")
### scale variables - singular values!
dataset      <- laufrad[,-which(names(laufrad) %in% drop)]
for( i in 1:length(daylist)){
POSTOP     <- dataset[dataset$day %in% c(-1, daylist[i]),  c(4, 5:9)]
POSTOP     <- POSTOP[complete.cases(POSTOP),]
# kick out partially empty columns
lossID         <- which(colSums(apply(POSTOP,2, FUN=is.na)) >0)
if(length(lossID)==0){
POSTOP  <- POSTOP
}else{
POSTOP  <- POSTOP[,-lossID]
}
# Boruta (eliminate missing columns where there are no comparisons!)
borutainput    <- POSTOP
set.seed(321)
out.boruta     <- Boruta(borutainput$day~., data = borutainput, doTrace=0)
f_name         <- paste("Boruta RW BSL vs day ", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Boruta Plots/Boruta RW/", f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 11, res = 300, compression = "lzw")
print( plot(out.boruta, cex.axis = 0.7, cex.lab=1.2, cex=1, las=2, xlab="", ylim=c(-10,25)) )
abline(h=0, lty=2)
dev.off()
}
########### PCA ###########
set        <- dataset[dataset$day %in% c(-1, daylist),  c(4, 5:9)]
set        <- set[complete.cases(set), ]
# PCA
tm.pca     <- prcomp(set[,-1], scale = TRUE, center=TRUE)
# contributions
var        <- get_pca_var(tm.pca)
var$contrib
sepath     <- "C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/PCA RW/"
# Variable contribution
f_name  <- paste("PCA_C",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 7,res = 300, compression = "lzw")
fviz_pca_var(tm.pca, col.var="contrib",
gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
repel = TRUE) + theme(text = element_text(size = 8.5),
axis.title = element_text(size = 13.5),
axis.text = element_text(size = 13.5))
dev.off()
f_name  <- paste("PCA_A",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 7,res = 300, compression = "lzw")
fviz_contrib(tm.pca, choice = "var", axes = 1, top = 28, xtickslab.rt = 90, ylim=c(0,45) )
dev.off()
f_name  <- paste("PCA_B",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 5,res = 300, compression = "lzw")
fviz_contrib(tm.pca, choice = "var", axes = 2, top = 28, xtickslab.rt = 90, ylim=c(0,45) )
dev.off()
# Full PCA plot
f_name  <- paste("PCA_D",".tiff",sep="")
mypath  <- paste(sepath, f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 1,res = 300, compression = "lzw")
mypalette <- c("darkgreen","red3","red2","orange","lightgreen","red4")
set$day[set$day==-1] <- "bsl"
set$day[set$day== 0] <- "post-op"
set$day[set$day== 1] <- "day 1"
set$day[set$day== 2] <- "day 2"
set$day[set$day== 4] <- "day 4"
set$day[set$day== 7] <- "day 7"
days      <- as.factor(set$day)
fviz_pca_ind(tm.pca,
col.ind       = factor(set$day),
title         = " ",
addEllipses   = T,
ellipse.type  = "confidence",
legend.title  = "Days",
geom.ind      = "point",
repel         = F,
ellipse.level = 0.95,
palette       = mypalette,#(5), # viridis_pal(option = "D")(9)
pointsize = 2)
dev.off()
set             <- laufrad
set
i=1
POSTOP          <- set[ set$day %in% c(-1, daylist[i]), ]
POSTOP$rot20    <- NULL
POSTOP$rr       <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP$vmax     <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
POSTOP
# Entropy Laufrad ---------------------------------------------------------
set             <- laufrad
for(i in 1:length(daylist)){
POSTOP          <- set[ set$day %in% c(-1, daylist[i]), ]
POSTOP$rot20    <- NULL
POSTOP$rr       <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP$vmax     <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
f_name         <- paste("RW Entropy BSL vs day", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Entropy/",f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
dev.off()
}
laura
laura[laura$day==7,]
?varrank
# Entropy Burrowing -------------------------------------------------------
set             <- laura
i=5
POSTOP          <- set[ set$day %in% c(-1, daylist[i]), ]
POSTOP
POSTOP          <- set[ set$day %in% c(-1, daylist[i]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
POSTOP
POSTOP[POSTOP$day != -1, ]
any(POSTOP[POSTOP$day != -1, ],NA)
all(is.na(POSTOP[POSTOP$day != -1, ])))
all(is.na(POSTOP[POSTOP$day != -1, ]))
all(is.na(POSTOP[POSTOP$day != -1, 3]))
check <- c()
for(j in 1:dim(POSTOP)[2]){
check[j]      <- all(is.na(POSTOP[POSTOP$day != -1, ]))
}
check
check <- c()
for(j in 1:dim(POSTOP)[2]){
check[j]      <- all(is.na(POSTOP[POSTOP$day != -1, j]))
}
check
check <- c()
for(j in 1:dim(POSTOP)[2]){
check[j]      <- all(is.na(POSTOP[POSTOP$day != -1, j]))
}
POSTOP[check]  <- NULL
POSTOP
# Entropy Burrowing -------------------------------------------------------
set             <- laura
for(i in 1:length(daylist)){
POSTOP          <- set[ set$day %in% c(-1, daylist[i]), ]
POSTOP$mgs30    <- NULL
POSTOP$mgs180   <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
# check if there are missing variables like ALL NAs
check <- c()
for(j in 1:dim(POSTOP)[2]){
check[j]      <- all(is.na(POSTOP[POSTOP$day != -1, j]))
}
POSTOP[check]  <- NULL
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
f_name         <- paste("Entropy BSL vs day", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Entropy/",f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
dev.off()
}
# Entropy Laufrad ---------------------------------------------------------
set             <- laufrad
for(i in 1:length(daylist)){
POSTOP          <- set[ set$day %in% c(-1, daylist[i]), ]
POSTOP$rot20    <- NULL
POSTOP$rr       <- NULL
POSTOP$bw       <- NULL
POSTOP$score    <- NULL
POSTOP$vmax     <- NULL
POSTOP          <- POSTOP[,4:dim(POSTOP)[2]]
# check if there are missing variables like ALL NAs
check <- c()
for(j in 1:dim(POSTOP)[2]){
check[j]      <- all(is.na(POSTOP[POSTOP$day != -1, j]))
}
POSTOP[check]  <- NULL
set.seed(321)
v   <- varrank(POSTOP,
method                = "estevez",
variable.important    = "day",
discretization.method = "sturges",
algorithm             = "forward",
scheme                = "mid" )
f_name         <- paste("RW Entropy BSL vs day", daylist[i],".tiff",sep="")
mypath         <- paste("C:/MHH Bleich/Papers/PostOPPaper/Relsa package/paper figures/Panels/Entropy/",f_name,sep="")
tiff(file = mypath, width = 1000, height = 1000, units = "px", pointsize = 6,res = 400, compression = "lzw")
plot(x=v, labelscex=1.5,colsep = FALSE, rowsep = FALSE, cellnote = T, notecex = 1, digitcell = 2  )
dev.off()
}
